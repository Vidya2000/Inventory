<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventory</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
    @media (max-width: 576px) {
        .form-control.w-auto {
            width: 100% !important;
        }
        .d-flex.gap-1 {
            flex-direction: column !important;
        }
        table {
            font-size: 0.9rem;
        }
        table td, table th {
            padding: 0.3rem;
        }
    }
</style>
</head>
<body class="bg-light">
<div class="container py-4">
<h2 class="mb-4 text-center animate__animated animate__fadeInDown">ðŸ“¦ Inventory</h2>
<div class="mb-3 text-center">
    <a href="{{ url_for('login') }}" class="btn btn-primary btn-sm animate__animated animate__pulse animate__infinite">Admin Login</a>
</div>

<!-- Live Search -->
<div class="card p-3 mb-4 animate__animated animate__fadeIn">
    <h4>Search Product</h4>
    <input type="text" id="searchBox" placeholder="Type Product ID or Name" class="form-control w-auto mb-2">
    <div id="searchResults"></div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="animate__animated animate__fadeIn">
    {% for category, msg in messages %}
      <div class="alert alert-{{ 'success' if category=='success' else 'danger' if category=='danger' else 'info' }} alert-dismissible fade show" role="alert">
        {{ msg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
    </div>
  {% endif %}
{% endwith %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script>
const searchBox = document.getElementById("searchBox");
const resultsDiv = document.getElementById("searchResults");

searchBox.addEventListener("input", function() {
    const query = this.value.trim();
    if(query.length === 0){
        resultsDiv.innerHTML = "";
        return;
    }

    fetch(`/search_products?q=${query}`)
        .then(response => response.json())
        .then(data => {
            const products = data.products;
            if(products.length === 0){
                resultsDiv.innerHTML = "<p>No matching products</p>";
                return;
            }

            let table = `<div class="table-responsive"><table class="table table-bordered"><thead>
                         <tr><th>ID</th><th>Name</th><th>Price</th><th>Stock</th>
                         <th>Sell</th></tr></thead><tbody>`;
            products.forEach(p => {
                const lowStockClass = p.stock < {{ LOW_STOCK_THRESHOLD }} ? "table-danger" : "";
                table += `<tr class="${lowStockClass}">
                            <td>${p.id}</td>
                            <td>${p.name}</td>
                            <td>${p.price}</td>
                            <td>${p.stock}</td>
                            <td>
                                <form action="/sell/${p.id}" method="post" class="mt-2">
                                    <div class="mb-2">
                                        <input type="number" name="quantity" min="1" placeholder="Qty" class="form-control form-control-sm" required>
                                    </div>
                                    <div class="mb-2">
                                        <input type="password" name="password" placeholder="Password" class="form-control form-control-sm" required>
                                    </div>
                                    <button type="submit" class="btn btn-success btn-sm w-100">Sell</button>
                                </form>
                            </td>
                          </tr>`;
            });
            table += "</tbody></table></div>";
            resultsDiv.innerHTML = table;
        });
});
</script>
</body>
</html>
